CoNSEnsX+ Webserver for the Analysis of Protein Structural Ensembles Reflecting Experimentally Determined Internal Dynamics
Abstract
Ensemble-based models of protein structure and dynamics reflecting experimental parameters are increasingly used to obtain deeper understanding of the role of dynamics in protein function. Such ensembles differ substantially from those routinely deposited in the PDB and, consequently, require specialized validation and analysis methodology. Here we describe our completely rewritten online validation tool, CoNSEnsX+, that offers a standardized way to assess the correspondence of such ensembles to experimental NMR parameters. The server provides a novel selection feature allowing a user-selectable set and weights of different parameters to be considered. This also offers an approximation of potential overfitting, namely, whether the number of conformers necessary to reflect experimental parameters can be reduced in the ensemble provided. The CoNSEnsX+ webserver is available at consensx.itk.ppke.hu. The corresponding Python source code is freely available on GitHub (github.com/PPKE-Bioinf/consensx.itk.ppke.hu).

Introduction
Besides their structure, the internal dynamics of proteins is regarded as a key determinant of their biological function. This dynamics ranges from the high conformational diversity of intrinsically disordered proteins and segments(1, 2) to well-defined structural rearrangements in globular proteins.(2, 3) While NMR spectroscopy provides unique possibilities to obtain information about conformational heterogeneity and internal motions at a diverse range of time scales, detailed structural interpretation of these parameters requires ensemble representations of protein structures that correspond to the experimental parameters.(4, 5) Such ensembles, referred to as “dynamic structural ensembles” below, differ substantially from those routinely deposited in the PDB. The reason for this is that most conventional structure calculation methods enforce the correspondence of the experimental parameters to each individual conformer in the ensemble and the diversity of the conformers stems from differences of the solutions to the same structure calculation problem. In contrast, ensemble-based methods inherently treat NMR-derived parameters as an ensemble property, and require the ensemble as a whole to correspond to these parameters. This treatment is expected to reflect reality better as with the exception of slow motions on the NMR time scale, the measured parameters represent an ensemble average and, in general, no individual conformation can be expected to fulfill all of them simultaneously.(6) Thus, these ensembles are usually substantially more diverse than typical “NMR ensembles” and require ensemble-based validation in terms of correspondence to experiments.(7)

Structural ensembles reflecting experimental parameters can be obtained either by ensemble-restrained molecular dynamics simulations(8, 9) or by selecting a subensemble from a suitable pool of conformers.(10, 11) Examples of parameters used for ensemble restraining include, among others, chemical shifts,(3) S2 order parameters,(12, 13) and residual dipolar couplings.(14, 15)

Whereas in such an ensemble each conformer should be checked for correct geometry just like for any protein structural model, validation in relation to experimental data is only meaningful at the level of the ensemble(7) and not on a per-model basis. As usual, an important aspect is cross-validation with data sets not used for the generation of the ensemble, requiring a general tool capable of handling a number of parameter types. Another important issue for dynamic structural ensembles is overfitting. Overfitting (or under-restraining) is the phenomenon where the number of replicas is larger than minimally required to conform to all measured parameters.(8) Larger ensembles might satisfy the experimental restrains more easily while incorporating conformations that are not realistically populated by the motions of the protein at the time scale modeled. Several aspects of overfitting can be handled during ensemble generation, e.g. the MUMO (minimal under-restraining, minimal over-restraining) calculation scheme was optimized with this respect.(8) Specifically, the overfitting stemming from the nonlinear averaging of nuclear Overhauser effect (NOE) based distances within the ensemble is suggested to be minimized by avoiding averaging the distances between more than two replicas.(8, 16)

To our knowledge, currently available software tools for ensemble generation and analysis are related to various aspects of selection and are focusing on ensembles with high structural variability such as intrinsically disordered proteins or multidomain proteins with flexible linkers. The downloadable packages ENSEMBLE(11) and ASTEROIDS(10) provide robust selection-based solutions primarily for intrinsically disordered proteins. The MaxOcc service(17) determines the maximum possible weight of a structural model within ans ensemble that can be compatible with the observed parameters.

There are a number of tools available for the validation of NMR structures, some of the capable of ensemble averaging, such as RPF(18) or PROSESS.(19) These servers are not specifically designed to handle dynamic structural ensembles, handle NMR chemical shift and NOE distance data only and do not offer a selection option.

Our aim was to develop a freely accessible web service that is capable of performing general ensemble-based validation step in a standardized and user-friendly way and also offering a simple and straightforward, multipurpose selection option. Therefore, updating our previous service CoNSEnsX,(20) we introduce CoNSEnsX+ with enhanced data handling and visualization features and, most importantly, a subensemble selection option that can both be used to generate dynamic ensembles and to check the presence of possible overfitting.

Results and Discussion
Features of the CoNSEnsX+ Server
The CoNSENsX+ server is a complete reimplementation of our previous CoNSEnsX service and is available at consensx.itk.ppke.hu. The server takes three files as input:
a multimodel PDB file containing the ensemble
an NMR-Star file with NOE-based distance restraints (accessible as “V2 NMR Restraints” at rcsb.org)
a BMRB-style NMR-Star format file with NMR parameters (chemical shifts, scalar and residual dipolar couplings, order parameters; see in detail below)
While submitting a PDB-format structural ensemble is mandatory, it is sufficient to provide only one of the BMRB/distance restraint files. The server is capable of evaluating backbone and side-chain S2 order parameters, amide N, H, Hα, Cα, and Cβ chemical shifts, 3JHNHα, 3JHNCα, 3JHNCβ, and 3JHNC scalar couplings as well as residual dipolar couplings. The server reports RMSD and Pearson correlation between all measured and ensemble-averaged back-calculated parameters, as well as the Q-factor for each RDC set. A plot is also presented showing the relationship between the correlation values obtained for the ensemble average and those calculated for the individual conformers.

For the back-calculation of RDCs, the server offers two options:
By default, PALES is invoked for each individual conformer with the SVD flag, resulting the alignment that provides the best correspondence to experimental RDCs. While this approach probably artificially improves the ensemble-level correspondence to RDCs, it accounts for the fact that individual conformers might align differently(21-23) in the medium and does not suffer from the limitations inherent in approximating the alignment based on the structures alone.
Optionally, the steric alignment of each conformer can be estimated using PALES. This approach seems less biased than the previous one and might also account for the diversity of alignments between conformers but alignment estimations yield worse results than SVD for individual molecules and can not be expected to perform equally well in all of the highly diverse medium types available for RDC measurements.

The server does not provide a single “measure of goodness” because the availability and quality of different kinds of NMR-derived parameters may greatly vary from case to case and thus no single measure is expected to be directly comparable between different proteins and would be both misleading and of limited practical use.
Key novel features of the CoNSEnsX+ server relative to the original version are
an option for structure superposition using a specified range of residues
recognition and analysis of side-chain methyl S2 order parameters
three Karplus equation parameter sets(24, 24, 25) can be selected for the calculation of 3J-couplings from the ϕ torsion
recognition of RDC data obtained in different experiments and invoking PALES separately for each RDC set measured under different conditions
improved graphical representation of the parameter comparisons

The most important novel feature of the server is the incorporation of a greedy selection approach for selecting a subensemble best corresponding to a user-defined set of parameters. The selection can be invoked after a round of initial evaluation and
can optimize the RMSD or Pearson correlation between the experimental and back-calculated parameters (if only RDCs are included in the target function, the Q-value can also be chosen)
uses parameter sets selected by the user to be included in the target function with a weight ranging from 0 to 10
is capable of overcoming the addition of conformers which cause temporary deterioration of the target value if later additions cause further improvements

Evaluation of the Ensemble Selection Feature
It should be noted here that in a dynamic structural ensemble it is not necessarily expected that any single member exactly corresponds to a conformer that is indeed occurring with a non-negligible probability in reality, but the conformational space represented by the ensemble as a whole should match that of the modeled real protein as closely as possible. Therefore, here we will focus on comparing the conformational space sampled by different ensembles to estimate the presence and extent of overfitting.
To evaluate and demonstrate the ensemble selection feature, we have selected three example cases including an SH3 domain, the peptidyl-prolyl cis–trans isomerase Pin1, and the disordered α-synuclein.

SH3 Domain with Synthetic Parameters
We have performed molecular dynamics calculations on the N-terminal SH3 domain of the Drk protein (PDB ID 2A36).(26) A 100 ns simulation was run with a time step of 1 fs at 300 K in implicit solvent using the GBSA algorithm.(27) The first model in PDB 2A36 was used as an input structure. The final 20 ns of the obtained trajectory was used as a reference ensemble for which various types of parameters (chemical shifts, five independent RDC sets and backbone S2 order parameters) were calculated. Using the chemical shifts and RDCs, a constricted ensemble was generated from the reference ensemble to test whether the observed parameters can be represented by a smaller set of conformers. As input for an independent selection, an initial pool covering a larger conformational space was generated with the accelerated molecular dynamics (AMD) scheme(28) as implemented by our group previously in GROMACS.(29) Four parallel 20 ns AMD simulations were carried out from the same starting structure but with different initial atomic velocities with an AMD boost potential of E = 2400 kJ/mol and an acceleration factor α = 0.5. The resulting set of conformers, denoted AMD pool below, is composed of the last 18.75 ns of the four AMD trajectories (3044 conformers). From this pool a number of subensembles were selected using various combinations of the “experimental” parameters calculated for the reference ensemble (Table S1). The conformational space covered by the different ensembles was approximated using principal component analysis.

In the reference ensemble, the first motional mode corresponds to a bending motion of the loop connecting the β2−β3 strands, denoted as the N-src loop in the literature, which is one of the loops flanking the ligand binding pocket.(30) The second mode describes the heterogeneity of the C-terminal 3 residues of the protein, which is not considered functionally relevant (Figure 1A–C, the position of a bound peptide is shown using the structure 4LNP(31)).

All selected ensembles reflect the first motional mode of the reference ensemble while achieving reasonable correspondence to all parameters considered (Table S1 and Figure S1). In the case of the constricted ensemble (Figure 1C), this reveals that the most important features of the reference ensemble can be well represented by a smaller set of conformers, providing a model case for assessing the extent of overfitting. Selections using the AMD pool reveal that similar ensembles can be selected from a pool that covers the conformational space of the reference ensemble (Figure 1E–H). Our deterministic greedy approach is not expected to be sensitive to the exact distribution of the conformers in the initial pool as long as it sufficiently covers the reference ensemble, as the probability of selecting a particular conformer to extend the ensemble depends only on its ability to optimize the correspondence to the parameters and not on the density of conformers in specific regions of the conformational space. Importantly, this kind of selection does not guarantee the selection of the best subensemble in terms of correspondence to the parameters and a stochastic selection might yield better results. Exact optimum could only be achieved by enumeration of all conformer combinations. Nevertheless, our approach is capable of selecting a subensemble corresponding reasonably well to the parameters and can be used to assess the extent of potential overfitting.

Pin1 Peptidyl-Prolyl Cis–Trans Isomerase
The Pin1 peptidyl-prolyl cis–trans isomerase was chosen as an example of a protein where a motional mode affecting the subdomains surrounding the substrate biding site has been suggested to play a role in catalysis and its regulation.(32, 33) We have generated three initial ensembles with different AMD parametrization from the starting structure 2RUC.(34) We have then evaluated these ensembles using the experimental chemical shifts deposited for this structure (BMRB ID 11559) and performed selections based on the chemical shifts. Correspondence to chemical shifts was generally high in all ensembles investigated and selected. However, all ensembles generated with AMD performed better than the original 2RUC ensemble available from the PDB, compatible with the general notion that a diverse ensemble fulfills the parameters more easily. This correspondence is still slightly improved for the selected subensembles which typically have between 5 and 15 members depending on the types of chemical shifts and measure (correlation or RMSD) used in the selection (see Table S2 for data on some highlighted ensembles). Although the differences are subtle, it is apparent that the subensembles selected from the AMD4800 pool exhibit the best correspondence to the experimental chemical shifts (Table S3). Principal component analysis reveals that the AMD4800 ensemble, generated with the longest simulation time, is the most diverse, and the subensembles selected from it contain conformers from the conformational space covered only by this ensemble (Figure S2A and B). To assess the significance of this observation, we checked whether the selected ensembles reflect a biologically relevant motion. To this end, we used the motional modes identified in our previous work using the consensus of three different dynamic structural ensembles and other parvulin-type PPIase (Rotamase) domains.(33) We focused on a subset of 53 CA atoms identifed previously as common to different PPIase domains based on a structure alignment. Results of a principal component analysis of these atomic positions were compared to our previously published PCA results.(33) It is clear the first motional mode of the ensembles selected from the AMD4800 pool shows a moderate but clearly detectable overlap with the motional mode believed to be functionally most relevant (Figure S2C and D), corresponding to the opening–closing motion around the ligand-binding site. In contrast, the full AMD5000 and AMD5200 pools and the subensembles selected from them show no such overlap. This analysis, besides highlighting the well-known importance of sufficient conformational sampling, reveals that even subtle improvements in the correspondence to experimental parameters can be relevant. Thus, at least in special cases, even this admittedly simple selection scheme is capable of producing a small ensemble with good overall correspondence to chemical shifts and—given a suitable initial pool of conformers—reflecting a biologically relevant dynamical feature.

α-Synuclein
An α-synuclein ensemble(36) available in pE-DB(5) (ID 9AAC) has been chosen to test the server on an intrinsically disordered protein. This ensemble was calculated based on paramagnetic relaxation enhancement (PRE) data,(37) the analysis of which is currently not implemented in our server. Therefore, we performed the calculations and selection using chemical shift data only, using BMRB entry 16300.(38) Thus, in this case the ensemble has been calculated based on experimental data different from those used for our selection. The selected ensemble consists of 37 members. PCA analysis reveals that the selected ensemble still covers the conformational variabilty described in the first four PCA modes of the original ensemble (Figure S3). Analysis of the secondary structure of the original and the selected ensembles shows that the positions of the helical segments are well reproduced in the selected ensemble, although the propensities are usually higher. It is important to stress here that the chemical shift data set does not exactly correspond to the experiments used for the calculation of the original ensemble, thus the slightly different secondary structure propensities might reflect relevant dependence on he exact conditions. In summary, we can conclude that the most relevant features of the conformational diversity of the disordered α-synuclein are still reasonably well captured with the selected ensemble, although the accuracy of the ensemble can not be expected to be comparable to that calculated based on PRE retraints.

Conclusions
Protein structural ensembles reflecting internal dynamics require specialized validation and analysis tools. The CoNSEnsX+ web server described here provides a convenient and reproducible way to assess the correspondence of ensembles to experimental NMR parameters. The selection feature allows both the generation of ensembles consistent with the data and to assess the extent of possible overfitting. Our selection approach does not guarantee to produce the smallest possible ensemble with a given level of correspondence to experimental data, but still sets an upper limit on the size of such well-performing ensembles. As our deterministic greedy approach starts with the single conformer best reflecting the selected data, the structural diversity of the selected ensemble is expected to be required to account for the experimental results and is not expected to be a result of arbitrary choice of the ensemble members. This consideration is in line with our results on various sample cases of selection described above.

Potential further uses of the CoNSEnsX+ tool could be in the field of protein structure prediction, because ensemble-based evaluation of protein models is an important issue in assessing the accuracy of the predicted conformations.(39) In addition, the selection feature can aid the choice of suitable low-dimensional projections to direct effective conformational sampling for proteins.(40)

Methods
Implementation of the CoNSEnsX+ Server
The CoNSEnsx+ method was implemented in Python, and the webserver interface has been built using the Django framework. The web application can be used with any webserver which implements the WSGI (webserver gateway interface) specification, like Nginx or Apache.
The following external libraries and programs have been incorporated:
NMRPystar library for parsing BMRB parameter files
ProDy protein structure analysis library for handling atomic coordinates including structure superposition(41)
SHIFTX program for the calculation of NMR chemical shifts from the structures,(42) chosen over the more accurate SHIFTX2(43) for its higher speed
PALES program to provide a standard way of calculating residual dipolar couplings from the structures(44)
PRIDE-NMR program to assess the general correspondence of the conformers to NOE-based distance restraints(45)

Uploaded data are stored in a SQL database on the server, as well as the pages with the results of the calculations. Since no registration is required to use the service, the result pages of the calculations ran by the user can be accessed using the permalink shown on the corresponding page. All calculated data are also stored in the SQL database to allow easy reuse. Loading the permalink gets the source of the generated result page in a single SQL query.
Ensemble-averaged values of all back-calculated parameters except NOE distances are calculated by simply taking the arithmetic mean of the values obtained for the individual conformers. NOE distances are averaged using the r–6 scheme for intramolecular distances in the case of restraints belonging to more than a single atom pair. For the full ensemble, r–6 or r–3 averaging can be chosen by the user. All back-calculated data except S2 order parameters are stored for each conformer for easy reuse in the selection algorithm.

The implemented selection algorithm is a version of a deterministic greedy approach. The process starts from a single conformer (for most experimental data types) or an ensemble of two conformers (for S2 order parameters) best corresponding to the included parameters according to the chosen measure. The approach iteratively adds further conformers resulting in the best possible correspondence for the enlarged ensemble at each step. It is generally required that the addition of the new conformers enhances the correspondence, whenever possible. To allow the generation of well-performing ensembles not necessarily achievable with the requirement of monotonic increase of the correspondence with each addition step, a so-called overdrive parameter can be set to allow decrease of the correspondence at several consecutive steps. Further extending the ensemble with additional conformers might yield an overall better correspondence even in such cases. The minimum and maximum size of the final subensemble to be returned can be specified as well as the measure by which the subensembles will be evaluated (Pearson correlation, Q-factor, or RMSD). If the calculation contained RDC sets and single value decomposition (SVD) was enabled, all the RDC parameters in a given set must have the same weight, if included in the target function. This policy is enforced by the weighting of the target function and can not be overridden. The output is the correspondence of the parameters to the full ensemble and the selected subensemble as well as the subensemble as a downloadable PDB file, in which the models are superimposed and their number in the original ensemble is marked.

Molecular Dynamics Calculations and Analysis of the Test Cases
For the generation of SH3 and Pin1 ensembles, molecular dynamics simulations were run with GROMACS 4.5.5,(46) when stated, using the accelerated molecular dynamics (AMD) scheme(28) as implemented previously by our group in this package.(29) PCA analysis in all cases was performed with ProDy.(41)

For the SH3 test case, a 100 ns simulation was run with a time step of 1 fs at 300 K in implicit solvent using the GBSA algorithm.(27) The first model in the PDB ensemble 2A36(26) was used as an input structure. The final 20 ns of the obtained trajectory was used as a reference ensemble for which various types of parameters (chemical shifts, five independent RDC sets, and backbone S2 order parameters) were calculated. As input for an independent selection, an initial pool covering a larger conformational space was generated with the AMD scheme. Four parallel 20 ns AMD simulations were carried out from the same starting structure but with different initial atomic velocities with an AMD boost potential of E = 2400 kJ/mol and an acceleration factor α = 0.5. The resulting set of conformers, denoted the AMD pool, is composed of the last 18.75 ns of the four AMD trajectories (3044 conformers). From this pool a number of subensembles were selected using various combinations of the “experimental” parameters calculated for the reference ensemble.

For the Pin1 test case, the first conformer of the PDB ensemble 2RUC(34) as a starting structure of three different AMD simulations (Table 1). Other parameters were the same as described for the SH3 test case.

Visual inspection of the ensembles was performed with MOLMOL.(35)
Secondary structure content evaluation of the α-synuclein ensmebles was performed by running DSSPcont(47) on each ensemble member and averaging the results.
