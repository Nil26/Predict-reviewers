Genetic demographic networks: Mathematical model and applications
Highlights
•
We present new method to model complex demographic networks.

•
We calculate exact joint allele distributions of individuals in populations.

•
Our method, in some cases, outperforms other known solutions.

•
We analyze genetic relationships between ancient Balts, Slavs and Finns.

•
We confirm the impact of genetic admixture in farming lifestyle spread in Europe.

Abstract
Recent improvement in the quality of genetic data obtained from extinct human populations and their ancestors encourages searching for answers to basic questions regarding human population history. The most common and successful are model-based approaches, in which genetic data are compared to the data obtained from the assumed demography model. Using such approach, it is possible to either validate or adjust assumed demography. Model fit to data can be obtained based on reverse-time coalescent simulations or forward-time simulations. In this paper we introduce a computational method based on mathematical equation that allows obtaining joint distributions of pairs of individuals under a specified demography model, each of them characterized by a genetic variant at a chosen locus. The two individuals are randomly sampled from either the same or two different populations. The model assumes three types of demographic events (split, merge and migration). Populations evolve according to the time-continuous Moran model with drift and Markov-process mutation. This latter process is described by the Lyapunov-type equation introduced by O’Brien and generalized in our previous works. Application of this equation constitutes an original contribution. In the result section of the paper we present sample applications of our model to both simulated and literature-based demographies. Among other we include a study of the Slavs–Balts–Finns genetic relationship, in which we model split and migrations between the Balts and Slavs. We also include another example that involves the migration rates between farmers and hunters–gatherers, based on modern and ancient DNA samples. This latter process was previously studied using coalescent simulations. Our results are in general agreement with the previous method, which provides validation of our approach. Although our model is not an alternative to simulation methods in the practical sense, it provides an algorithm to compute pairwise distributions of alleles, in the case of haploid non-recombining loci such as mitochondrial and Y-chromosome loci in humans.

Keywords
Demographic networks Gene genealogies Allele joint distributions Finns–Balts–Slavs history Farming expansion Cro-Magnoids and Neanderthals

1. Introduction
With increasing availability of genome-wide data, including data from extinct species, new questions about history of species and populations are asked and answered. Only in the recent years we have obtained genome sequences from three main hominins: Neanderthals (Green et al., 2010), ancient modern humans (Rasmussen et al., 2010) and high quality 30-fold coverage of Denisovans (Meyer et al., 2012). These data preserve traces of information about past events occurring in the population history, such as founder effects, bottlenecks, migrations, admixtures and so forth. Historically, there were two distinct approaches (Hey and Machado, 2003) to retrieve this knowledge: the phylogeographic approach based on the gene-tree analysis, and the summary statistics that concentrated on comparing some aspect of data, such as the numbers of variable sites in or between populations. Recently, the model-based analysis (Stoneking and Krause, 2011) combines both approaches. In this approach, estimates of the parameters obtained from assumed demographies are directly compared to real genetic data. An important version of this approach is the reverse-time coalescent approach. In its Bayesian version, the posterior probability of model parameters can be obtained and in this way different models can be compared. This approach has been widely developed over recent years (Beaumont and Rannala, 2004, Wollstein et al., 2010). Bayesian methods are frequently computationally intensive (Hox, 2002). Nevertheless, the Approximate Bayesian Computation (ABC) has been used a lot to study models with more than 3 populations and generally high complexity (Arenas et al., 2015).

Over the last few years, many theories regarding human ancient history have been tested using the methods described. For example, in Haak et al. (2010) authors discuss ancestry of the Eastern Europe Neolithic farmers and infer their Near East affinities. In Hellenthal et al. (2008) different models of human colonization history have been tested. As an example, genetic material of an archaic hominin has been found in the Denisova Cave in Siberia and its genetic history and relationship to modern humans from several population as well as to Neanderthals have been discussed in Reich et al. (2010) and Meyer et al. (2012) to infer human population history from individual whole-genome sequences.

One approach to calculate estimates of the demography parameters is using model-based samples generated via forward-time generation-to-generation or backward-time coalescent-based computer simulations. Extensive review of such programs has been introduced in Kuhner (2009), and more recently in Hoban et al. (2012) listing the following three simulation platforms as the leading ones: quantiNEMO (Neuenschwander et al., 2008), ForSim (Lambert et al., 2008) and simuPop (Peng and Kimmel, 2005). The results obtained from simulations need to be averaged over many runs in order to correctly estimate population-specific values.

Here, we introduce a computational Demographic Network (DN) Model that allows developing predictions of bivariate allele distributions in pairs of individuals sampled from the same or two different populations, given a potentially complicated demography. The two individuals are randomly sampled from either the same or two different populations. The model assumes three types of demographic events (split, merge and migration). Populations evolve according to the time-continuous Moran model with drift and Markov-process mutation. This latter process is described by the Lyapunov-type equation introduced by O’Brien and generalized in our previous works; for references see the recent short monograph (Bobrowski and Kimmel, 2015). This equation has been generalized in several directions, including process with recombination (Bobrowski et al., 2010). In the current version of the DN model, recombination has not been taken into account. In some applications, the DN Model may complement the simulation models. Although the DN is not an alternative to simulation methods in the practical sense, it provides an algorithm to compute pairwise distributions of alleles, in the case of haploid non-recombining loci such as mitochondrial and Y-chromosome loci in humans. The DN Model leads to exact pairwise distributions, and usually runs very fast.

The DN Model is not intended to replace the demographic inference procedures that infer demography from the site frequency spectrum, and can summarize whole-genome data from multiple populations. However, it is still interesting to compare DN-network performance with other methods, which have been summarized for example in Gutenkunst et al. (2009) or  Kuhner (2009). Many popular methods developed so far limit, for computational reasons, the number of populations in the model to a single population (BEAST (Drummond and Rambaut, 2007)), two (IM (Nielsen and Wakeley, 2001), IMa (Hey and Nielsen, 2007, Nielsen et al., 2009)) or three (  (Gutenkunst et al., 2009)) populations. Other methods with multiple populations have no subsequent migration after subpopulations split (Adams and Hudson, 2004). Methods that consider multiple populations with migration often assume limited population size growth scenario (LAMARC (Kuhner, 2006), MIGRATE_N (Beerli and Felsenstein, 1999)) or mutation model (no microsatellite model in BEAST (Drummond and Rambaut, 2007) or constant mutation rate (Kuhner, 2006)). Some approaches allow using only a limited set of summary statistics (Becquet and Przeworski, 2007) or are computationally very intensive (Schaffner et al. (2005) or  Kuhner (2006) for number of populations greater than 3). The authors of the Denisovans paper (Reich et al., 2010) used Li and Durbin’s method based on the PSMC model (Li and Durbin, 2011). The approach we use for comparison is simCoal (Laval and Excoffier, 2004) and its new versions fastsimcoal (Excoffier and Foll, 2011) and fastsimcoal2 (Excoffier et al., 2013). Our approach allows flexibility in the definition of mutation model (see Example 3 in which we consider the microsatellite model) and population growth scenario (we can accommodate any realistic scenario). DN Model can be coupled with a local search algorithm, such as the Nelder–Mead search algorithm used in Example 2, to draw conclusions about the early Neolithic transition from hunting–gathering to farming.

2. Methods and models
We consider a demographic network of populations evolving from an ancestral population. Evolution in the network begins at time  and continues in forward time. The network includes three types of discrete events: merges of two populations into one, splits of a single population into two and migrations between pairs (possibly all) of populations in the network (Sections  2.2 Description of a demographic network, 2.3 Relations between populations in the network). Between the events, the populations evolve according to a time-continuous version of the Wright–Fisher model, further on called the Moran model as described in Section  2.1.

2.1. Evolution of the network distributions between the events
Between the events, populations evolve according to the time-continuous Moran model with drift and Markov-process mutation. This latter process is described by the Lyapunov-type equation introduced by O’Brien and generalized in  Bobrowski et al. (2001); however, see also the brief monograph by Bobrowski and Kimmel (2015). Current section follows Bobrowski et al. (2001). We assume that each chromosome evolves under genetic drift and mutation between two consecutive network events. We assume that the allelic state  of the chromosome sampled from population  at time  evolves as a time-continuous non-negative Markov chain with transition intensity matrix , where  and . We denote , where  and  if . We assume that the matrix remains unchanged between two demographic events but may vary among different populations or different time intervals (the state space remaining the same). By ,  we denote the transition probability matrix corresponding to matrix . In the finite-dimensional case (if  is finite) we obtain . The same holds for the uniform denumerable case, as explained in Section 6.10 of Grimmett and Stirzaker (2001).

Let us first consider two alleles randomly drawn from the same population , and assume that the MRCA of these two individuals with allelic types  and  (, ) existed at time  before the present time . Based on the Kingman–Moran coalescent (Kingman, 1982), with time-variable population size  we obtain that . The MRCA can be of any allelic type with probability  and its descendants at the present time  have types  and , respectively. Then, summing over all possible values of and integrating over the range of  results in (Bobrowski et al., 2001):
(1)

Expression (1) may be transformed into matrix notation and we can separate the evolution of the population in the time interval before  and interpret it as the initial conditions (Bobrowski et al., 2001). This leads to the following equation:
(2)
where ,  is the transpose of the matrix  and  is a diagonal matrix with .

The case when the two alleles are drawn from different populations  and  is simpler as there is no coalescence. In summary,

(3)
where .

 given by expression (3) is a mild solution (Pazy, 1983) of the following matrix differential equation related to the Lyapunov equation (Gajic et al., 1995):
(4)
where  and  is the Kronecker delta.

We will use Eq. (4) rather than expressions (3) to evaluate the joint distribution in the time interval between two adjacent events in the network.

2.2. Description of a demographic network
We consider a demographic network of populations evolving from an ancestral population. Evolution in the network begins at time  and continues in forward time. The network includes three types of discrete events: merges of two populations into one, splits of a single population into two and migrations between pairs (possibly all) of populations in the network. These events are chronologically ordered and occur at times ,  and , where  is the present. We allow more than one event to occur at the same time, but these events are distinguished from each other and are considered separately one after another according to the numbering order.

We denote the number of populations in the network in the time interval  by , where  and , and  is the indicator of change of the number of populations corresponding to the type of event which occurred at time :
(5)

Each population in the network is identified in the time interval  by a single index . Numbering starting from 0 results from the convenience of software implementation. The index of the population may change as a result of an event. If the index of the population is , , in the time interval , then we denote by , , the corresponding index in the preceding time interval . If population  splits at time , then
(6)
If two populations with indices  and  () merge at time , then
(7)
i.e., the merged population has index  and the population with index  is removed from the network.

Migration event at time  is described by matrix ,  with entries , , , being the migration rates from population  to . Migration does not change the indices of the populations. Such migration model allows for versatility in describing the migration pattern among populations. Continuous migration can be approximated by introducing either many migration events separated by short time periods or a single migration event for each time period between other network events. In the latter case it is needed to estimate single migration event rates corresponding to the rates of the continuous migration model.

The population size of population  at time  is denoted by , .

2.3. Relations between populations in the network
We consider a genetic feature (allele) associated with a haploid chromosome which can be sampled from any population in the network. We describe this feature using the allelic space  containing  allelic types indexed from 1 to . We seek answer to the following question: What is the probability that a chromosome randomly sampled from population  at time  has allele  and that another individual from population  ( is admissible) has allele  ? These probabilities are entries of the joint distribution matrices ,  and . To avoid notational ambiguity, we denote by  the th row, th column entry of matrix .

As above, if the index of the population is denoted by , , in the time interval , then this population has index denoted by , , if it existed in the previous time interval . Matrices  and  indicate the joint allelic distributions in the two populations immediately after and immediately before the event at time , respectively.

If a split event occurs at time , the allele on the chromosome in the splitting population is inherited by two chromosomes, each in a different progeny populations. Hence for this case we obtain the following identity:
(8)

If the event that occurs at time  is a merge, the allele in the merged population is sampled from the two merging populations  and  with respective probabilities and , where . This results in the following formula for the joint distributions:
(9)
where .

A single migration event from one population  to another  is considered a merge of the whole destination population  with a part of the population . Only the distributions of the destination population are affected. Assuming that the event that occurred at time  is described by the migration matrix , the size of the part of the population  contributing to the event is given by .

A migration event in the network describes all possible migrations between two populations in the network. Therefore, a single population may be affected by a number of different migrations taking place at the same time. It leads to complex relationships between joint distributions characterizing the populations involved in the migration events. We model such a migration event using the following two-step scenario:
•
Split each population in the network  times in order to separate all subpopulations migrating out of populations. The population size ratio parameters used in the splits are given by the migration matrix .

•
Merge the migrating subpopulations determined in the previous step with proper destination populations. It is not necessary to apply any particular ordering to these merges.

Suppose there are  subpopulations present. Therefore,  populations (and joint distributions) need to be stored simultaneously. To optimize this method we may separately consider the subpopulations migrating from each original population, and then apply the splits and merges scenario  times, once for each determined joint subpopulation. Merge operations immediately follow splits. As a result, at most  populations are stored at the same time.

If the migration event changes the population sizes, the modified values of the population size satisfy the following formula:
(10)

2.4. Time and memory complexity
Mutation and drift effect between two events is computed according to expression (4). In order to numerically solve the ODE we use the Runge–Kutta 4th order (RK4) algorithm (Gear, 1971, Forsythe et al., 1977), with adaptive control of the step size using the Cash–Karp method (Press et al., 1988, Cash and Karp, 1990).

Population-specific intensity matrix  is usually sparse whereas the number of allele types  is large. The most time-consuming operation of the implemented Runge–Kutta algorithm is the  multiplication. Using sparsity of matrix significantly reduces the time complexity. We accomplish this by storing, for a matrix with the fraction of non-zero entries not exceeding a threshold value, all non-zero values in a set of lists. Each list corresponds to a row or column of the matrix. This results in 2nd-order polynomial time-complexity of multiplication if at least one of the matrices multiplied is sparse.

Time  and memory  complexities depend on the number of populations  and the size of the allelic types space . Time complexity also depends on the mutation model. We assume that the intensity matrix  is sparse with the average of  nonzero values per row or per column. In each RK4 step we need 12 matrix multiplication, each with complexity , and about 60 other operations running in  time but requiring the initialization of the matrix. Thus, , where  is a number of splits or merges and  is the average number of steps in the RK4 algorithm for a single time interval. Usually , especially when we use an adaptive step control algorithm. The method is feasible even for  and .

We need to store  intensity matrices and  joint distributions in the algorithm, therefore  bytes. As we see, the memory limit is manageable even for large realistic cases.

2.4.1. Time benchmarks
All calculations of execution times in this section have been conducted using an average personal computer with 2 GHz processor with eight cores. We assume that the main benchmark model is a single population scenario in which one population evolves over a time period of  generations — long enough to model most realistic modern human demographies. We use five different values of the allele state space size : 2, 8, 32, 128 and 512. The times presented in Fig. 1(A) show that our model is feasible for  and runs extremely fast for small sizes of .

Next, we add split events to the single-population scenario, being the only events that not only increase the number of disjoint time periods in which the population is modeled under the mutation–drift model, but also increase the number of populations. From this point of view splits are the worst case scenario. We start with one population and after each 100 generations we split the ancestral population into two. After we reach the assumed number of populations in the network, we model the network until 10,000 generations elapse. We consider two different values of : 2 and 32, and four different values of population number: 1, 2, 5 and 10. The results are presented in Fig. 1(B). The model can be applied to complex demographies with more than 10 populations, in which the locus is a short haplotype sequence or a realistic human microsatellite. These cases cover many applications; see Examples 1, 2 and 3 in the Results section. None of the existing direct calculation programs can model such demographies. In Fig. 1(C) we show that our program runtime only weakly depends on the simulated time length. In this experiment, we run the multipopulation scenario, but we vary the number of generations that follow the last split over the 0 to 100,000 range. The execution time increases logarithmically as a function of the simulation time.

The program that calculates the joint distributions for a demography described by an input script file is available on the website http://sun.aei.polsl.pl/~twojdyla/genpop/.

3. Results
In this section we present several examples of how the DN Model can be applied to analyze data. In the first application we model a simple two-population network and use our model to determine values of the linkage disequilibrium. In the latter applications we apply the method to modeling of ancestral genetic data.

3.1. Simple example: linkage disequilibrium caused by drift and population size change
We assume that at time  an ancestral population splits into two subpopulations. The first one is the ancestral population with constant size . The second population starts from 1000 individuals and grows exponentially with a parameter 0.001 per generation. We consider a single nucleotide mutation model with recurrent mutations of two variants:  and . Mutation rate in both populations is constant and equal to 0.0002 per generation. We note the marginal distributions, , ,  and . We compute the normalized Lewontin linkage disequilibrium  between populations  and   (Lewontin, 1964): , where  is a non-normalized linkage disequilibrium and  if  or  otherwise. Lewontin’s index is usually applied to quantify linkage between alleles at different loci on the same chromosome, but here it is used to quantify dependence between the alleles at the same locus on different chromosomes. The results presented in Fig. 2 are consistent with intuition. The joint distribution in population 0 remains at equilibrium while in population 1 it gradually evolves leading to a decrease of the value of  as the force of drift decreases in a growing population. The cross-association of homologous loci from two different populations after the split rapidly decreases.

3.2. Predictions and estimates of species and populations history
3.2.1. Example 1. Cro-Magnoids, Neanderthals and modern Europeans.
Availability of genetic data from different species and populations allows various, often very sophisticated, intra- and inter-population analyses. Particularly, it is possible to estimate the past demography of these populations, including interactions between populations. An example of a commonly used model-based analysis (Stoneking and Krause, 2011) is provided by the works of Barbujani’s group who, among other, studied the genetic relationship among Neanderthals (N), Cro-Magnoids (CM) and modern Europeans (M) (Belle et al., 2009). The authors calculated the values of parameters such as pairwise difference or haplotype diversity for samples drawn from populations simulated under about a dozen hypothetical demographic scenarios, and compared these values to the data obtained from DNA of the individuals in the sample. Simulations followed the so-called serial coalescent (Laval and Excoffier, 2004), a reverse-time multipopulation algorithm. Area of applicability of our demographic network model overlaps with that of the serial coalescent. We apply DN Model to the scenarios used by Barbujani’s group in paper by Belle et al. (2009), to obtain the estimates of pairwise differences among populations. Details are relegated to Appendix; results are in a good agreement with Belle et al. (2009).

3.2.2. Example 2. Agriculture spread in Europe.
In Neolithic Europe a transition occurred from hunting and gathering (HG) to an agricultural lifestyle. The spread of farmers (F) originated around 11,000 years ago in the Near East and farming reached Scandinavia about 6000 years ago (Skoglund et al., 2012). The advantage of the new form of food acquisition caused a complete replacement of the HG communities. What is unknown is the manner in which the replacement proceeded. There are two theories explaining the process. The first claims that HG learned the technique from their farming neighbors, while the second includes a genetic admixture between these two communities (Haak et al., 2010). To answer the question which theory is more likely we estimate the migration rate  between HG and F populations using the mitochondrial hypervariable segment I (HVS-I mtDNA) data from four populations and a demographic model in Fig. 3. Small values of  correspond to the first theory and large values to the second. Details are relegated to Appendix; results show again a good agreement with those obtained by other methods.

We tested the DN Model results using parametric bootstrap analysis in which, first, we generated multiple samples using fastsimcoal2, then we calculated the values for simulated populations, and, finally, we estimated model parameters based on these simulation-based values using the DN Model. In the fastsimcoal2 simulations we used population structures exactly as defined in our models. We also used such sample sizes as they are given by the genealogic data. Overall, we performed 20 simulations of the model describing agricultural spread. The number of simulations is low in this case because of the necessity to manually run the Nelder–Mead local search method multiple times for each simulation.

We determined for each obtained set of the  values the range of model parameters values that minimizes the error function  in a way explained in Appendix. In Fig. 5(A)–(D) we present the values of four model parameters, , ,  and , as function of the number of simulations (out of 20) in which the obtained range of the values of a given parameter contains that parameter value. We notice that the functions obtained for the population sizes have peaks near the values obtained directly from the DN Model. The migration rate is more widely spread and its peak values are lower than our estimate (equal to 0.4). Nonetheless, the results support the hypothesis of nonzero migration rate between farmers and hunters–gatherers.

3.2.3. Example 3. Finnish admixture in Balts and Slavs
In contrast to the previous examples, this one is, as far as we know, original. It also requires developing a specialized version of the master equation describing drift and mutation between demographic events that is applicable to microsatellite loci (see further on). We use the demographic network model to study the history of several Central Eastern European populations based on Y chromosome data. We focus on relations between the Slavs occupying the territory of the modern Poland and the Central Balts — ancestors of the modern Lithuanians and Latvians. Both Proto-Slavs and Proto-Balts are likely to have originated from nomadic tribes that had left the Indo-European homeland and diversified into most of the modern European people. It is argued that these groups came to Europe in the 2nd millennium BC (Gornung, 1963, Borzyskowski, 2010), but the exact chronology is unclear (McEvedy and Woodcock, 2002). Both Poles and Lithuanians are genetically considerably distinctive (Ploski et al., 2002) from other European populations. However, analysis of the Y-chromosome haplogroups of the modern Eastern Europeans shows that other ancient populations should also be considered (group, 0000). The Balto-Slavic branch of the Indo-European genealogy belongs to the R1a haplogroup. However, about 45% of the population of the modern Lithuania and Latvia belongs to the N1c1 haplogroup, which is the haplogroup of the non-Indo-European North-Eurasian Finns who entered Europe during the Corded Ware period at the beginning of the 3rd millennium BC (Baldia, 2006). Balts, after the split from other Indo-European groups, settled along the south-eastern coast of the Baltic Sea and assimilated with the Finnic tribes living there (Thomas, 1992). Our studies concern the influence the N1c1 haplogroup had on the Balts and Slavs. The exact times of splits of Balts and Slavs, or Finns from their ancestral populations are unknown and estimating these times is one of the objective of current example. Another interesting aspect of the Balt–Slav relationship is migrations between these two groups in the 6th century, when Slavs appeared for the first time on the territory of Poland, and in the 14th century, when the Commonwealth of Poland and Lithuania (1384–1795) came into existence. Fig. 4(A) illustrates the modeled demographic scenario. We estimate the ancient population sizes of all groups based on the assumption that human population growth rates are equal to Kremer’s values (Kremer, 1993) and assume that the population size between two adjacent Kremer’s times changes according to an exponential function with a single human generation assumed to last 25 years, with the resulting rates listed on the left in Fig. 4(A). Following Barbujani’s group approach (Belle et al., 2009) we assume that the effective to census population size ratio in humans is placed between 0.3 (Jorde, 1980) and 0.5 (Nunney, 1993), and since considering the Y-STR haplotype chromosome introduces a factor  to this ratio (Perez-Lezaun et al., 1997), we assume that the effective population size is ten times smaller than the census data size. These estimates are in apparent contradiction to the estimates of the recognized estimates of the effective population size of modern humans, of the order of   (Harpending and Rogers, 2000). However, in the current setting, it seems more appropriate to consider the “ecological” effective population sizes, as Belle et al. (2009) do.

We use the Slatkin’s   (Slatkin, 1995) to quantify the distance between two populations. We calculate the  distance between Slavs and Balts based on the data from 919 unrelated male Polish individuals sampled from six geographical regions of Poland and 297 Balt descendants (152 from Vilnius and 145 from Riga). Genetic data at nine microsatellite loci (DYS19, DYS389I, DYS389II, DYS390, DYS391, DYS392, DYS393, DYS385a and DYS385b) are considered. The data can be obtained from Kayser et al. (1997). We use the Arlequin program (Excoffier et al., 2005) to obtain a normalized (Goodman, 1997) value of the Slatkin’s distance. We obtain that the  value for samples of Poles and Balts is equal to 0.03862. Our aim is to adjust the parameters of the scenario in Fig. 4(A) to obtain a model explaining the obtained value of the  distance.

Developing a version of the Lyapunov Equation, suitable for microsatellite loci. It is known that under the Stepwise Mutation Model (SMM), it is sufficient to model the differences in the number of tandem repeats between loci rather than the absolute numbers (Kimmel and Chakraborty, 1996). Therefore, distributions become infinite vectors () with components indexed by all integers and consecutive entries corresponding to these differences. For practical application, we consider that the possible value of the differences is finite, and unlikely to be high. The center entry  of the vector corresponds to the case when no change of the number of tandem repeats occurred. As a result, we replace the Lyapunov equation (4) by the following specialized equation:
(11)
where , is the probability generating function of an integer-valued random variable equal to the difference in allele size between individuals sampled from populations  and  () at time , where  and  are mutation intensities in both populations,  is a vector of the same dimension as  with the value of 1 at  and all other entries equal to 0 and  is the Kronecker delta. Detailed description regarding obtaining expression (11) may be found in Kimmel et al. (1998) and more recently in Li and Kimmel (2013). Deeper mathematical foundations have been established in Bobrowski and Kimmel (2004). Given the values of ,  and , the average sum of squared difference distance ( distance) between populations  and  results in the following formula:
(12)
where  is the variance of the allele size differences in populations  and  ( is admissible) given by the following formula:
(13)

Fig. 4(B)–(D) presents estimates of the genetic distance between descendants of Slavs and Balts for different times of splits and migration rates. The required value of the Slatkin’s distance may be obtained by more than one set of parameter’s values. Therefore, although the estimates provide information about common history of modeled groups, they are not sufficient to determine the exact scenario. The estimates depend on the effective population sizes, which cannot be precisely estimated, but recently developed methods indicate improvement in this area, especially if the genetic data are of good quality (Li and Durbin, 2011).

We also considered a scenario according to which the Balts were not admixed by Finns (consider Fig. 4A leaving out the Finns). The  distance is presented in Fig. 4E, as a function of the Balt–Slav split time . It is seen that in this case the  distance is dramatically lower than that computed based on microsatellite data.

To verify our method of estimating the  distance between populations we compare our results to the results generated by fastsimcoal2 (Excoffier et al., 2013). We consider three models: i) our Slavs–Balts model with parameter values , ,  and , ii) population with constant size of 3000 experiencing split into two populations of sizes 2000 and 1000 which happened generations before the present time ( varies between 100 and 1000), and iii) model from ii) with additional migration event occurring 100 generations after the split. In each serial coalescent experiment we generate 10 loci samples and average the values over 20 random coalescent genealogies. In each case, the difference in the  estimates between the two methods is lower than the standard deviation of the serial coalescent results. In model one in which we fitted the DN Model to the data-based , we obtained from the serial coalescent method that the value between Slavs and Balts in our Slavs–Balts demographic model is equal to  (Fig. 4(F)). DN Model estimates calculated for the second model for  give , while from fastsimcoal2 we obtain . Introducing the migration event decreases the  values to 0.336 using the DN Model and to  for fastsimcoal2.

Additionally, we performed a bootstrap analysis of the Slavs–Balts model, in which we assume that times of the splits estimated in the model are equal to the previously obtained values (,  and ) and under such assumptions we calculate migration rate . Fig. 5(E) presents the cumulative number of occurrences of that migration rate, for a range of migration values discretized using a 0.01 step, in a sample of 100 simulations. The median value of the migration rate is equal to 0.17 and is close to the value estimated originally by DN Model (which was 0.2). Moreover, for most simulated demographies, the value of the estimated migration rate is between 0.05 and 0.3.

4. Discussion
In this paper, we introduced mathematics and applications of the demographic networks. The main advantage of the DN Model is its ability to efficiently compute the joint allelic distributions in pairs of haploid genomes when more than two populations are involved. As a comparison, in the framework of diffusion approximations, which provide another frequently used methodology (cf. Poisson random fields (Desai and Plotkin, 2007)) such computations frequently seem less straightforward. Returning to the mathematical core of the DN Model, we may list a number of limitations. Our model as of now, concerns neutral evolution only and does not involve recombination. In addition, the mathematics will be substantially more complicated if distributions not of pairs, but of larger samples of individuals, are modeled. The computational complexity in such cases remains to be explored. Recombination has not been incorporated in the algorithm, although it may be drawn into the picture for example by extending the algorithm of Polanska and Kimmel (Kimmel and Polanska, 1999, Bobrowski et al., 2010). Finally, modeling of a wider range of different mutation patterns is to be perfected. This concerns, among other, modeling of data from genome sequencing. Selection will most likely be difficult to take into account. However, even modeling of benchmark neutral scenarios may be a helpful alternative to existing simulation or exact methods. This is especially true if the network contains many populations.

We provided three examples of application of the DN Model. Example 1 concerns evolutionary and demographic scenarios linking Cro-Magnon people, Modern Humans and Neanderthals which were previously considered by Belle et al. (2009), using the serial coalescent techniques. We show that demographic networks produce similar results, as the serial coalescent (Fig. 6E).

In Example 2, we study the genetic relationships between hunters–gatherers and farmers in early Neolithic Europe based on the mtDNA genetic data obtained from ancient human relics of both groups found on the territory of modern Germany. Our results are consistent with a high migration rate () between those populations. This contradicts the alternative theory claiming that a farming lifestyle in Europe spread solely be technological transmission. Low, but slightly higher, values of the error function used in our model were also obtained for , what suggests that the ancient genetic material of hunters–gatherers might have been replaced by the farmers almost completely. The general outcome is consistent with the results obtained previously in Bramanti et al. (2009) and Haak et al. (2010) using different approaches.

Example 3, which is original, concerns the little-known demographic genetics of the peoples of Central Eastern Europe: Slavs, Balts and Finns. Analysis of a demographic network model applied to Y-chromosome microsatellites indicates that it is necessary to consider the admixture of the Proto-Finns into the Balts, to explain the genetic distance between these latter and the Slavs (as represented here by Poles). This result is obtained using the documented and hypothetical timings of historical and prehistorical events and a search in parameter space. Despite a number of unknowns, the assertion appears robust.

Benchmark results indicate the main areas of use of our model. Our approach is useful in modeling the evolution of non-recombining genetic material from many populations organized in a complex demographic network, especially when the number of possible allele variants is small. This includes using mtDNA or Y chromosome data represented either by short haplotype sequences or microsatellite loci. In such cases our model can be applied for complex scenarios.

Appendix A.
Example 1
The models used in our calculations are taken from the Fig. 1 in Belle et al. (2009). All the models assume that the Neanderthals (N) and Cro-Magnoids (CM) lived 1700 and 960 generations ago, respectively, with generation time assumed equal to 25 years. All the models except L1.7 assume a single population with different growth rates. Model L1.1 is a constant size population. In L1.2, the population grows after the origin of CM. Models L1.3 and L1.4 introduce to L1.2 a small growing rate before origin of N; rapid expansion from CM to Moderns (M) is assumed in L1.4. In L1.5 the population grows to the same large size as in L1.4, but with more balanced growth rates in each time interval. L1.7 models the population from L1.5 with an assumption that there existed a separate shrinking N population. Models labeled by H have assumed mutation rate ten times larger (0.5 per million years per nucleotide instead of 0.05 as in models starting with L). Demography of H1.1 is the same as in L1.2. Demographies of H1.2 and H1.3 are slightly different versions of L1.3. We summarize all of these demographies in Fig. 6(A)–(D). For more details see Belle et al. (2009). Both models assume infinite site mutation model approximated by a long haplotype sequence of 360 nucleotides with two possible variants at each position. Given the joint distribution  we can calculate the mean pairwise difference  in population  according to the following formula:

(A.1)
where  is the number of positions at which the sequences of allelic types  and  differ. Table 1 and Fig. 6(E) compare our results to those obtained by Belle and co-workers in Belle et al. (2009) using serial coalescent approach. Discrepancies between simulation and our methods, which are largest for the CM population, are as expected considering a very small CM sample size (only 2 individuals), and the fact that median (not mean) value was listed by Belle et al. The sample sizes of N and M populations used in the serial coalescent approach were equal to 6 and 558, respectively.

Example 2
The data we use are predominantly from Haak et al. (2010), complemented by other sources. As Hunter–Gatherer (HG) population we used 20 individuals of post-LGM (Last Glacial Maximum) hunters–gatherers with mtDNA haplogroup U found on the territory of modern Germany (Bramanti et al., 2009). It is assumed that these individuals lived about 13,000–10,000 years ago. The genetic data of the Farmer (F) population were mostly obtained from the Derenburg graveyard in Germany (Haak et al., 2005, Haak et al., 2010) and consist mtDNA samples of 42 farmers from Neolithic Linear Pottery Culture (LBK). The age of the graveyard has been estimated to be about 7200 years. The area of the LBK consists of territories close to the middle Danube, the upper and middle Elbe, and the upper and middle Rhine. Two remaining populations are 1030 modern Central Europeans (CE) from the LBK core area and 737 modern Near Easterners (NE) from Anatolia. The values of the distance between each pair of populations have been obtained from  Bramanti et al. (2009) and  Haak et al. (2010) and are summarized in Table 2.

We assume that before the LGM the ancestors of HG had separated from the common ancestral population (A) and migrated to Europe (Fig. 3). Then, about 11,000 years ago the farmers started to spread in Europe mixing with the HG individuals at the total migration rate , where  stands for migration before the time of graveyard in Derenburg and  after this time. Post-neolithic demography is modeled by CE–NE admixture at rate  at the present time with the fraction of the proper mtDNA haplogroup U distribution in modern Europe assumed to be equal to 15%. Population size growth rates before the year 2000 BP are as estimated by Kremer (1993), and after that year we assume exponential growth of the haplogroup U carriers up to the 15% of the CE and NE population sizes at the present time. As a mutation model we use a simple one-base two-allele haplotype model with recurrent mutations and mutation rate equal to 3×10−5 per base per generation (Howell et al., 1996). We also assume that the ancestral population was in a drift–mutation equilibrium during the time of split of the HG population. The value of the  at time  between populations  and  may be calculated using the joint distributions ,  and  as follows:
(A.2)
where  and  are the allele variants.

Overall, we have 6 parameters in the model (, , , ,  and ). We use the Nelder–Mead local search method (Nelder and Mead, 1965) to evaluate demographic parameters minimizing the error function , where the six  values are these from Table 2, and  are the values obtained from the model. We obtain that the lowest value of  () is achieved for  with other parameters ranging as follows: , , ,  and . The overall result from our model is similar to that published in Haak et al. (2010) using Bayesian Serial Simcoal (Chan et al., 2006) and it supports the genetic admixture theory. Our estimates of  and  agree with the most probable values estimated in Bramanti et al. (2009) using coalescent simulations.